import{D as R}from"./Dropdownlist.1b365210.js";import{W as g,c as u,b as e,e as p,x as $,Z as b,aL as v,i as w,d as f,aM as m,w as k,v as l,ae as x,o as h,H as C}from"./entry.5eee13ba.js";import"./_plugin-vue_export-helper.c27b6911.js";const V={key:0,class:"fixed inset-0 overflow-hidden","aria-labelledby":"slide-over-title",role:"dialog","aria-modal":"true"},D={class:"absolute inset-0 overflow-hidden"},U=e("div",{class:"absolute inset-0","aria-hidden":"true"},null,-1),M={class:"absolute inset-y-0 right-0 pl-10 max-w-full flex"},j={class:"w-screen max-w-md"},q={class:"h-full divide-y divide-gray-200 flex flex-col bg-white shadow-xl"},S={class:"flex-1 h-0 overflow-y-auto"},N={class:"space-y-1 py-6 px-4 bg-primary-200 bg-opacity-50 sm:px-6"},A={class:"flex items-center justify-between space-x-3"},B=e("h2",{class:"text-lg leading-7 font-medium text-gray-700"},"Role",-1),I={class:"h-7 flex items-center"},H=e("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),P=[H],Z=e("div",null,[e("p",{class:"text-sm leading-5 text-gray-500"},"Create or update Role")],-1),z={key:0,class:"flex-1 flex flex-col justify-between"},T=C('<div class="space-y-6 pt-6 pb-5"><div class="flex justify-center"><span class="inline-flex"><button type="button" class="inline-flex items-center px-6 py-3 text-base font-medium text-gray-600"><svg class="-ml-1 mr-3 h-5 w-5 animate-spin" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" aria-hidden="true"><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> Processing... </button></span></div></div>',1),W=[T],E={key:1,class:"flex-1 flex flex-col justify-between"},F={class:"px-4 divide-y divide-gray-200 sm:px-6"},L={class:"space-y-6 pt-6 pb-5"},O={class:"sm:overflow-hidden"},G={class:"bg-white space-y-6"},J={class:"grid grid-cols-1 gap-y-3 gap-x-4 sm:grid-cols-6"},Q={class:"sm:col-span-6"},K=e("label",{for:"first_name",class:"block text-sm font-medium text-gray-700"},"Name",-1),X={class:"mt-1"},Y={class:"sm:col-span-6"},ee=e("label",{for:"first_name",class:"block text-sm font-medium text-gray-700"},"Code",-1),te={class:"mt-1"},se=e("p",{class:"mt-2 text-sm text-gray-500"},"Custom code used as unique constraint. If the same string exists will be thrown duplicate record error.",-1),oe={class:"sm:col-span-6"},ae={class:"sm:col-span-6"},ie={class:"w-full flex-shrink-0 px-4 py-4 space-x-4 flex justify-end"},le=e("span",{class:"inline-flex rounded-md shadow-sm"},[e("button",{type:"button",class:"py-2 px-4 border border-gray-300 text-sm leading-5 font-medium text-gray-700 hover:text-gray-500 focus:outline-none focus:border-blue-300 focus:shadow-outline-blue active:bg-gray-50 active:text-gray-800 transition duration-150 ease-in-out"},"Reset")],-1),de={key:0,class:"inline-flex rounded-md shadow-sm"},ne={class:"inline-flex rounded-md shadow-sm"};let y="/api/roles/";const re={components:{},data(){return{isUpsertRoleVisible:!1,isDeleteButtonVisible:!1,data:{},date:new Date,progress:!1}},methods:{getRole(a){this.progress=!0;const{data:s}=m(y+a,{method:"post",initialCache:!1,onResponse({request:n,response:d,options:r}){console.log("Response from promise",d._data.document),this.data=d._data.document,this.progress=!1}},"$8jWbiMrhZ2");k(s,()=>{console.log("Role = ",JSON.stringify(s)),this.data=s._rawValue.document,this.isDeleteButtonVisible=!0,this.progress=!1})},async upsertRole(a){try{if(this.progress=!0,this.data._id===void 0){this.data.createdAt=l().$dayjs().utc(),this.data.updatedAt=l().$dayjs().utc();const{data:s}=await m(y+"create",{method:"post",body:this.data,initialCache:!1,onResponse({request:n,response:d,options:r}){d._data.insertedId&&l().$toast.show({type:"success",message:`Role [${d._data.insertedId}] added successfully`,timeout:6})}},"$S3gMTQq7A6")}else{const{data:s}=await m(y+this.data._id,{method:"put",body:_.omit(this.data,"_id"),initialCache:!1,onResponse({request:n,response:d,options:r}){d._data.modifiedCount>0&&l().$toast.show({type:"success",message:"Record has been updated successfully",timeout:6})}},"$mg0tZPk5HG")}this.progress=!1,l().$bus.$emit("evtSearchRole",{filter:{},limit:10}),this.data={},this.isUpsertRoleVisible=!this.isUpsertRoleVisible}catch(s){console.log(s),this.progress=!1}finally{}},async deleteRole(){try{await m("/api/roles/"+this.data._id,{method:"delete",body:{},initialCache:!1,onResponse({request:a,response:s,options:n}){s._data.deletedCount==1?(console.log("deletedCount = ",s._data.deletedCount),l().$toast.show({type:"success",message:"Delete was successful",timeout:6}),this.progress=!1,this.isUpsertRoleVisible=!1,l().$bus.$emit("evtSearchRole",{filter:{},limit:10}),this.data={}):(this.progress=!1,l().$toast.show({type:"error",message:"The delete failed...",timeout:6}))}},"$Inq4cNf7HD")}catch{}finally{}},async closeRolePanel(){this.data={},this.isUpsertRoleVisible=!this.isUpsertRoleVisible},handleSelectedInRole_record_status(a){this.data.record_status=a.target.value},handleSelectedInRole_mark_as_delete(a){this.data.mark_as_delete=a.target.value}},created(){l().$bus.$on("evtUpsertRole",a=>{a!==void 0&&this.getRole(a._cells[0].data),this.isUpsertRoleVisible=!this.isUpsertRoleVisible}),l().$bus.$on("evtDeleteRole",a=>{a!==void 0&&(this.data=a,this.deleteRole())})},beforeDestroy(){l().$bus.$off("evtUpsertRole"),l().$bus.$off("evtDeleteRole")}},me=Object.assign(re,{__name:"RoleUpsert",async setup(a){let s,n;const{data:d}=([s,n]=g(()=>x("record_status-list-"+Math.random,()=>$fetch("/api/generic",{initialCache:!1,method:"post",body:{collection:"properties",projection:{},filter:{property_type:{$eq:"record_status"}},limit:1e4},onResponse({request:t,response:o,options:c}){}}),"$DiiqyinMM7")),s=await s,n(),s),{data:r}=([s,n]=g(()=>x("mark_as_delete-list-"+Math.random,()=>$fetch("/api/generic",{initialCache:!1,method:"post",body:{collection:"properties",projection:{},filter:{property_type:{$eq:"mark_as_delete"}},limit:1e4},onResponse({request:t,response:o,options:c}){}}),"$My9EWZtF1c")),s=await s,n(),s);return(t,o)=>{const c=R;return t.isUpsertRoleVisible?(h(),u("section",V,[e("div",D,[U,e("div",M,[e("div",j,[e("div",q,[e("div",S,[e("header",N,[e("div",A,[B,e("div",I,[e("button",{onClick:o[0]||(o[0]=i=>t.closeRolePanel()),"aria-label":"Close panel",class:"rounded-md bg-primary-700 text-primary-200 hover:text-white focus:outline-none focus:ring-2 focus:ring-white"},P)])]),Z]),t.progress?(h(),u("div",z,W)):p("",!0),t.progress?p("",!0):(h(),u("div",E,[e("div",F,[e("div",L,[e("form",{name:"frmRole",id:"frmRole",class:"space-y-8 divide-y divide-gray-200",onSubmit:o[5]||(o[5]=$((...i)=>t.upsertRole&&t.upsertRole(...i),["prevent"]))},[e("div",O,[e("div",G,[e("div",J,[e("div",Q,[K,e("div",X,[b(e("input",{type:"text",id:"name",name:"name","onUpdate:modelValue":o[1]||(o[1]=i=>t.data.name=i),class:"py-3 px-4 block w-full pl-5 focus:ring-lime-600 focus:border-lime-600 border-gray-300"},null,512),[[v,t.data.name]])])]),e("div",Y,[ee,e("div",te,[b(e("input",{type:"text",id:"code",name:"code","onUpdate:modelValue":o[2]||(o[2]=i=>t.data.code=i),class:"py-3 px-4 block w-full pl-5 focus:ring-lime-600 focus:border-lime-600 border-gray-300"},null,512),[[v,t.data.code]])]),se]),e("div",oe,[w(c,{data:{data:f(d).documents},onChange:t.handleSelectedInRole_record_status,show_label:"true",modelValue:t.data.record_status,"onUpdate:modelValue":o[3]||(o[3]=i=>t.data.record_status=i),name:"record_status",label:"Record Status",selected_value:t.data.record_status},null,8,["data","onChange","modelValue","selected_value"])]),e("div",ae,[w(c,{data:{data:f(r).documents},onChange:t.handleSelectedInRole_mark_as_delete,show_label:"true",modelValue:t.data.mark_as_delete,"onUpdate:modelValue":o[4]||(o[4]=i=>t.data.mark_as_delete=i),name:"mark_as_delete",label:"Mark for Deletion",selected_value:t.data.mark_as_delete},null,8,["data","onChange","modelValue","selected_value"])])])])])],32)])])]))]),e("div",ie,[le,t.isDeleteButtonVisible?(h(),u("span",de,[e("button",{onClick:o[6]||(o[6]=i=>("useNuxtApp"in t?t.useNuxtApp:f(l))().$bus.$emit("evtDeleteRole",t.data)),type:"button",class:"py-2 px-4 border border-gray-300 text-sm leading-5 font-medium text-gray-700 hover:text-gray-500 focus:outline-none focus:border-primary-300 focus:shadow-outline-blue active:bg-gray-50 active:text-gray-800 transition duration-150 ease-in-out"},"Delete")])):p("",!0),e("span",ne,[e("button",{onClick:o[7]||(o[7]=(...i)=>t.upsertRole&&t.upsertRole(...i)),type:"submit",class:"zyn-button"},"Save")])])])])])])])):p("",!0)}}});export{me as default};
