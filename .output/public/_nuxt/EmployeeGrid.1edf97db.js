import{V as n,j as u,W as f,M as h,c as x,b as s,aM as y,v as r,ae as g,o as b}from"./entry.5eee13ba.js";import{a as w,b as v}from"./mermaid.4b1cd600.js";const $={class:"px-4 sm:px-4 lg:px-4"},E=s("div",{class:"sm:flex sm:items-center"},null,-1),k={class:"mt-2 flex flex-col"},C={class:"-my-2 -mx-4 overflow-x-auto sm:-mx-6 lg:-mx-8"},M={class:"inline-block min-w-full py-2 align-middle md:px-6 lg:px-8"},N={components:{},data(){return{data:[],filter:{}}},methods:{buildMongoQueryFilterCriteria(e){let t={};if(_.isString(e.name)){let i={};i.a={first_name:{$regex:".*"+e.name+".*",$options:"i"}},i.b={last_name:{$regex:".*"+e.name+".*",$options:"i"}},t.$or=[i.a,i.b]}return _.isString(e.client)&&(t.client={$regex:".*"+e.client+".*",$options:"i"}),t},async searchEmployees(){this.progress=!0;try{let e=await y("/api/employees",{method:"post",initialCache:!1,body:{projection:n("mongo_query").value.projection,filter:this.buildMongoQueryFilterCriteria(this.filter),limit:_.isNumber(this.filter.limit)?parseInt(this.filter.limit):1e4}},"$Khp7OEOUk6");setTimeout(()=>{n("grid").value.updateConfig({data:e.data._rawValue.documents}).forceRender(),this.progress=!1},2e3)}catch(e){this.progress=!1,r().$toast.show({type:"danger",message:e.message,timeout:6})}}},created(){r().$bus.$on("evtSearchEmployee",e=>{this.filter=e,this.searchEmployees()})}},S=Object.assign(N,{__name:"EmployeeGrid",async setup(e){let t,i;const m="/api/employees/",l=n("grid"),c=n("mongo_query",()=>({projection:{},filter:{},limit:25})),d=u(),{data:p}=([t,i]=f(()=>g("Employees-list-"+Math.random,()=>$fetch(m,{initialCache:!1,method:"post",body:c.value,onResponse({request:a,response:o,options:j}){this.data=o._data.documents}}),"$7JnsaqZfPn")),t=await t,i(),t);return h(()=>{l.value=new w({columns:[{id:"_id",name:"Id.",hidden:!0},{data:a=>a.last_name+", "+a.first_name,name:"Name",width:"200px"},{id:"email",name:"Email",width:"100px"},{id:"client",name:"Client",width:"100px",hidden:!0},{id:"work_location",name:"Work Location",hidden:!0},{id:"mobile_phone",name:"Mobile",width:"100px",hidden:!0},{id:"department",name:"Department",hidden:!1},{id:"role",name:"Role",hidden:!1},{id:"btnEdit",name:"",formatter:(a,o)=>v("button",{className:"inline-flex items-center rounded-full border border-transparent bg-lime-600 px-3 py-1.5 text-xs font-medium text-white shadow-sm hover:bg-lime-700 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2",onClick:()=>r().$bus.$emit("evtUpsertEmployee",o)},"Edit"),sort:!1,width:"50px"}],sort:!0,pagination:{enabled:!0,limit:25,summary:!0},className:{td:"whitespace-nowrap px-2 py-2 text-sm text-gray-500",table:"min-w-full divide-y divide-gray-300",thead:"bg-gray-50",th:"whitespace-nowrap px-2 py-3.5 text-left text-sm font-semibold text-gray-900"},search:!0,fixedHeader:!0,data:p._rawValue.documents}),l.value.render(d.value)}),(a,o)=>(b(),x("div",$,[E,s("div",k,[s("div",C,[s("div",M,[s("div",{ref_key:"gridRef",ref:d},null,512)])])])]))}});export{S as default};
